<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CulturalMap - Itinerar Cultural</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: #333;
}

body[data-theme="dark"] {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    color: #fff;
}

header {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 20px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 100;
}

body[data-theme="dark"] header {
    background: rgba(26, 26, 46, 0.95);
}

.logo {
    font-size: 28px;
    font-weight: bold;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.header-buttons {
    display: flex;
    gap: 10px;
}

.toggle-theme, #historyBtn {
    padding: 10px 20px;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.toggle-theme {
    background: #667eea;
    color: white;
}

#historyBtn {
    background: #4CAF50;
    color: white;
}

.toggle-theme:hover, #historyBtn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}

.auth-container {
    max-width: 450px;
    margin: 80px auto;
    background: white;
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    animation: slideIn 0.5s ease-out;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

body[data-theme="dark"] .auth-container {
    background: rgba(26, 26, 46, 0.9);
    color: white;
}

.auth-container h2 {
    text-align: center;
    margin-bottom: 30px;
    color: #667eea;
}

.auth-container input {
    width: 100%;
    padding: 15px;
    margin-bottom: 15px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 16px;
}

.auth-container input:focus {
    outline: none;
    border-color: #667eea;
}

.auth-container button {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 18px;
    cursor: pointer;
}

.auth-container button:hover {
    transform: scale(1.05);
}

.app-container {
    max-width: 1400px;
    margin: 40px auto;
    padding: 0 20px;
}

.welcome-section {
    background: white;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    margin-bottom: 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

body[data-theme="dark"] .welcome-section {
    background: rgba(26, 26, 46, 0.9);
}

.welcome-section h2 {
    color: #667eea;
}

.welcome-section button {
    padding: 10px 20px;
    background: #ff5252;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
}

.main-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
}

.control-panel {
    background: white;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
}

body[data-theme="dark"] .control-panel {
    background: rgba(26, 26, 46, 0.9);
}

.control-panel label {
    display: block;
    margin-bottom: 10px;
    font-weight: bold;
    color: #667eea;
}

.control-panel select, .control-panel input {
    width: 100%;
    padding: 15px;
    margin-bottom: 20px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 16px;
}

.control-panel select:focus, .control-panel input:focus {
    outline: none;
    border-color: #667eea;
}

.generate-btn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 18px;
    cursor: pointer;
}

#map {
    height: 500px;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
}

.day {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.3s;
    opacity: 0;
    transform: translateY(20px);
}

.day.show {
    opacity: 1;
    transform: translateY(0);
}

.day:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.day h3 {
    color: #667eea;
    margin-bottom: 15px;
}

.objectives {
    list-style: none;
}

.objectives li {
    padding: 10px;
    margin-bottom: 5px;
    background: white;
    border-radius: 8px;
}

.time {
    color: #764ba2;
    font-weight: bold;
    margin-right: 10px;
}

.restaurant-card {
    /* Folosit acum È™i pentru link (a) */
    min-width: 280px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    overflow: hidden;
    transition: all 0.3s;
    cursor: pointer;
    text-decoration: none; /* EliminÄƒ sublinierea link-ului */
    color: inherit; /* PÄƒstreazÄƒ culoarea textului */
    display: block; /* Face ca link-ul sÄƒ ocupe tot spaÈ›iul cardului */
}

.restaurant-card:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
}

.restaurant-img {
    width: 100%;
    height: 180px;
    object-fit: cover;
}

.restaurant-info {
    padding: 15px;
}

.restaurant-name {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 5px;
    color: #667eea;
}

.restaurant-cuisine {
    color: #666;
    font-size: 14px;
    margin-bottom: 10px;
}

.stars {
    color: #FFD700;
    font-size: 16px;
}

#restaurantsSection {
    background: white;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

body[data-theme="dark"] #restaurantsSection {
    background: rgba(26, 26, 46, 0.9);
}

#restaurantsSection h2 {
    color: #667eea;
    margin-bottom: 20px;
}

#restaurantsList {
    display: flex;
    overflow-x: auto;
    gap: 20px;
    padding: 20px 0;
}

#rightMenu {
    position: fixed;
    top: 0;
    right: 0;
    width: 350px;
    height: 100%;
    background: white;
    box-shadow: -5px 0 20px rgba(0,0,0,0.3);
    padding: 30px;
    z-index: 999;
    overflow-y: auto;
    display: none;
}

body[data-theme="dark"] #rightMenu {
    background: rgba(26, 26, 46, 0.98);
}

#closeMenuBtn {
    float: right;
    background: #ff5252;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
}

#pastTripsList, #futureTripsList, #toDoList {
    list-style: none;
    padding: 0;
}

#toDoList li {
    padding: 12px;
    background: #fff3cd;
    margin-bottom: 8px;
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
}

.faq-section {
    background: white;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
}

.faq-question {
    width: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 15px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    margin-bottom: 10px;
}

.faq-answer {
    display: none;
    padding: 15px;
    background: #f5f7fa;
    border-radius: 10px;
    margin-bottom: 15px;
}

.edit-controls {
    margin-top: 10px;
    margin-bottom: 15px;
}

.add-objective-select {
    width: 100%;
    padding: 10px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    margin-bottom: 5px;
}

.add-objective-btn {
    margin-top: 5px;
    padding: 8px 15px;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}

.move-select {
    float: right;
    margin-left: 10px;
    padding: 4px;
}

.trip-date-input {
    width: 100%;
    padding: 10px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    margin: 10px 0;
    font-size: 14px;
}

.trip-badge {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 5px;
    font-size: 11px;
    font-weight: bold;
    margin-left: 8px;
}

.badge-past {
    background: #ff9800;
    color: white;
}

.badge-future {
    background: #4CAF50;
    color: white;
}

</style>
</head>
<body data-theme="light">

<header>
    <div class="logo">âœˆ CulturalMap</div>
    <div class="header-buttons">
        <button class="toggle-theme" onclick="toggleTheme()">ğŸŒ™</button>
        <button id="historyBtn">ğŸ“‹ Trips</button>
    </div>
</header>

<div class="auth-container" id="auth-container">
    <div id="register-form">
        <h2>Ãnregistrare</h2>
        <input type="text" id="reg-username" placeholder="Username">
        <input type="password" id="reg-password" placeholder="Parola">
        <button onclick="register()">ÃnregistreazÄƒ-te</button>
        <p style="text-align:center; margin-top:15px;">Ai cont? <a href="#" onclick="showLogin()">Login</a></p>
        <p id="reg-msg" style="color:red;"></p>
    </div>

    <div id="login-form" style="display:none;">
        <h2>Login</h2>
        <input type="text" id="login-username" placeholder="Username">
        <input type="password" id="login-password" placeholder="Parola">
        <button onclick="login()">Login</button>
        <p style="text-align:center; margin-top:15px;">Nu ai cont? <a href="#" onclick="showRegister()">Ãnregistrare</a></p>
        <p id="login-msg" style="color:red;"></p>
    </div>
</div>

<div class="app-container" id="app-container" style="display:none;">
    <div class="welcome-section">
        <h2>Bun venit, <span id="user-name"></span>! ğŸ‘‹</h2>
        <button onclick="logout()">Logout</button>
    </div>

    <div class="main-content">
        <div class="control-panel">
            <h2 style="color:#667eea; margin-bottom:20px;">ğŸ“ PlanificÄƒ cÄƒlÄƒtoria</h2>
            <label for="city">OraÈ™</label>
            <select id="city">
                <option value="Paris">ğŸ‡«ğŸ‡· Paris</option>
                <option value="Madrid">ğŸ‡ªğŸ‡¸ Madrid</option>
                <option value="Tokyo">ğŸ‡¯ğŸ‡µ Tokyo</option>
                <option value="Rome">ğŸ‡®ğŸ‡¹ Rome</option>
                <option value="Milan">ğŸ‡®ğŸ‡¹ Milan</option>
                <option value="New York">ğŸ‡ºğŸ‡¸ New York</option>
                <option value="Amsterdam">ğŸ‡³ğŸ‡± Amsterdam</option>
                <option value="Sydney">ğŸ‡¦ğŸ‡º Sydney</option>
                <option value="Singapore">ğŸ‡¸ğŸ‡¬ Singapore</option>
                <option value="Barcelona">ğŸ‡ªğŸ‡¸ Barcelona</option>
                <option value="Bangkok">ğŸ‡¹ğŸ‡­ Bangkok</option>
                <option value="Istanbul">ğŸ‡¹ğŸ‡· Istanbul</option>
                <option value="London">ğŸ‡¬ğŸ‡§ London</option>
                <option value="Hong Kong">ğŸ‡­ğŸ‡° Hong Kong</option>
                <option value="Mecca">ğŸ‡¸ğŸ‡¦ Mecca</option>
                <option value="Dubai">ğŸ‡¦ğŸ‡ª Dubai</option>
                <option value="Macau">ğŸ‡²ğŸ‡´ Macau</option>
                <option value="Kuala Lumpur">ğŸ‡²ğŸ‡¾ Kuala Lumpur</option>
                <option value="Seoul">ğŸ‡°ğŸ‡· Seoul</option>
                <option value="Beijing">ğŸ‡¨ğŸ‡³ Beijing</option>
                <option value="Shanghai">ğŸ‡¨ğŸ‡³ Shanghai</option>
                <option value="Lisbon">ğŸ‡µğŸ‡¹ Lisbon</option>
                <option value="Prague">ğŸ‡¨ğŸ‡¿ Prague</option>
                <option value="Vienna">ğŸ‡¦ğŸ‡¹ Vienna</option>
                <option value="Venice">ğŸ‡®ğŸ‡¹ Venice</option>
                <option value="Los Angeles">ğŸ‡ºğŸ‡¸ Los Angeles</option>
                <option value="San Francisco">ğŸ‡ºğŸ‡¸ San Francisco</option>
                <option value="Mexico City">ğŸ‡²ğŸ‡½ Mexico City</option>
                <option value="Cairo">ğŸ‡ªğŸ‡¬ Cairo</option>
            </select>

            <label for="days">Zile</label>
            <input type="number" id="days" min="1" max="14" value="3" />
            <button class="generate-btn" onclick="generateItinerary()">ğŸš€ GenereazÄƒ</button>
        </div>

        <div id="map"></div>
    </div>

    <div id="restaurantsSection" style="display:none;">
        <h2>ğŸ½ Localuri din <span id="selectedCity"></span></h2>
        <div id="restaurantsList"></div>
    </div>

    <div class="itinerary-section">
        <div id="output"></div>
    </div>

    <div class="faq-section">
        <h2>â“ FAQ</h2>
        <button class="faq-question">Cum aleg zilele?</button>
        <div class="faq-answer">Depinde de timp È™i obiective.</div>
        <button class="faq-question">Pot adÄƒuga obiective?</button>
        <div class="faq-answer">Da, poÈ›i personaliza itinerariul.</div>
    </div>
</div>

<div id="rightMenu">
    <button id="closeMenuBtn">âœ•</button>
    <h2>My Trips</h2>

    <div style="margin:20px 0;">
        <h3>ğŸ“ Last Trips</h3>
        <ul id="pastTripsList"></ul>
    </div>

    <div style="margin:20px 0;">
        <h3>ğŸ“… Future Trips</h3>
        <ul id="futureTripsList"></ul>
        <button onclick="saveCurrentTrip()" style="width:100%; padding:10px; background:#2196F3; color:white; border:none; border-radius:8px; margin-top:10px; cursor:pointer;">ğŸ’¾ Save Current Trip</button>
    </div>

    <div>
        <h3>âœ… To-Do</h3>
        <div style="display:flex; gap:10px; margin:10px 0;">
            <input type="text" id="todoInput" placeholder="Task..." style="flex:1; padding:10px; border:2px solid #e0e0e0; border-radius:8px;">
            <button onclick="addTodo()" style="padding:10px 20px; background:#4CAF50; color:white; border:none; border-radius:8px; cursor:pointer;">+</button>
        </div>
        <ul id="toDoList"></ul>
    </div>
</div>


<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let map;
let editableItinerary = [];
let currentCity = "";
let allCityAttractions = [];
let currentTripIndex = null;
let isViewingTrip = false;

// DATE RESTAURANTE EXTINSE
const restaurantsData = {
    "Paris": [
        { name: "Le Jules Verne", cuisine: "French", rating: 4.8, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "L'Ami Jean", cuisine: "Bistro", rating: 4.7, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Septime", cuisine: "Contemporary", rating: 4.9, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Clamato", cuisine: "Seafood", rating: 4.5, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Frenchie", cuisine: "Modern French", rating: 4.6, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" }
    ],
    "Rome": [
        { name: "La Pergola", cuisine: "Italian", rating: 4.9, img: "https://images.unsplash.com/photo-1515003197210-e0cd71810b5f?w=400" },
        { name: "Roscioli", cuisine: "Trattoria", rating: 4.7, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Taverna Trilussa", cuisine: "Roman", rating: 4.5, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Checchino dal 1887", cuisine: "Traditional", rating: 4.4, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "ImÃ go", cuisine: "Fine Dining", rating: 4.8, img: "https://images.unsplash.com/photo-1515003197210-e0cd71810b5f?w=400" }
    ],
    "Tokyo": [
        { name: "Sukiyabashi Jiro", cuisine: "Sushi", rating: 5.0, img: "https://images.unsplash.com/photo-1579584425555-c3ce17fd4351?w=400" },
        { name: "Narisawa", cuisine: "Japanese", rating: 4.9, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Kanda", cuisine: "Japanese", rating: 4.8, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Den", cuisine: "Creative Japanese", rating: 4.7, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Afuri Ramen", cuisine: "Ramen", rating: 4.5, img: "https://images.unsplash.com/photo-1579584425555-c3ce17fd4351?w=400" }
    ],
    "Madrid": [
        { name: "DiverXO", cuisine: "Avant-garde", rating: 4.9, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "BotÃ­n", cuisine: "Spanish", rating: 4.6, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "StreetXo", cuisine: "Fusion", rating: 4.7, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Cebo", cuisine: "Contemporary", rating: 4.5, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Casa Lucio", cuisine: "Spanish/Classic", rating: 4.4, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" }
    ],
    "London": [
        { name: "The Ledbury", cuisine: "European", rating: 4.9, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Dishoom", cuisine: "Indian", rating: 4.7, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Core by Clare Smyth", cuisine: "Modern British", rating: 4.8, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "The Palomar", cuisine: "Modern Jerusalem", rating: 4.6, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Padella", cuisine: "Pasta", rating: 4.5, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" }
    ],
    "New York": [
        { name: "Eleven Madison Park", cuisine: "American", rating: 4.9, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Le Bernardin", cuisine: "Seafood", rating: 4.9, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Per Se", cuisine: "Contemporary", rating: 4.8, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Gramercy Tavern", cuisine: "American", rating: 4.6, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Via Carota", cuisine: "Italian", rating: 4.7, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" }
    ],
    "Milan": [
        { name: "Ristorante Cracco", cuisine: "Fine Dining", rating: 4.8, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Seta", cuisine: "Italian", rating: 4.9, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "D'O", cuisine: "Modern Italian", rating: 4.7, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Piz", cuisine: "Pizza", rating: 4.5, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "L'Immagine Bistrot", cuisine: "Bistrot", rating: 4.4, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" }
    ],
    "Amsterdam": [
        { name: "RIJKS", cuisine: "Modern Dutch", rating: 4.8, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Ciel Bleu", cuisine: "European", rating: 4.9, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Bussia", cuisine: "Italian", rating: 4.6, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "De Kas", cuisine: "Farm to Table", rating: 4.5, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Foodhallen", cuisine: "Street Food", rating: 4.3, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" }
    ],
    "Sydney": [
        { name: "Quay", cuisine: "Australian", rating: 4.9, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Aria", cuisine: "Modern Australian", rating: 4.7, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Bennelong", cuisine: "Contemporary", rating: 4.8, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Tetsuya's", cuisine: "Japanese Fusion", rating: 4.6, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Mr. Wong", cuisine: "Chinese", rating: 4.5, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" }
    ],
    "Singapore": [
        { name: "Odette", cuisine: "French", rating: 4.9, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Les Amis", cuisine: "French", rating: 4.8, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Burnt Ends", cuisine: "BBQ", rating: 4.7, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Candlenut", cuisine: "Peranakan", rating: 4.6, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Tiong Bahru Market", cuisine: "Hawker", rating: 4.3, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" }
    ],
    "Barcelona": [
        { name: "Disfrutar", cuisine: "Avant-garde", rating: 4.9, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Tickets", cuisine: "Tapas", rating: 4.8, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "El Nacional", cuisine: "Spanish", rating: 4.5, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Cinc Sentits", cuisine: "Catalan", rating: 4.7, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Bar CaÃ±ete", cuisine: "Tapas", rating: 4.4, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" }
    ],
    "Bangkok": [
        { name: "Gaggan", cuisine: "Progressive Indian", rating: 4.9, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Sorn", cuisine: "Southern Thai", rating: 4.8, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Le Du", cuisine: "Modern Thai", rating: 4.7, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Blue Elephant", cuisine: "Royal Thai", rating: 4.5, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Thipsamai Pad Thai", cuisine: "Street Food", rating: 4.4, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" }
    ],
    "Istanbul": [
        { name: "Mikla", cuisine: "Anatolian", rating: 4.8, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Nicole", cuisine: "Mediterranean", rating: 4.7, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Neolokal", cuisine: "New Anatolian", rating: 4.6, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Balikci Sabahattin", cuisine: "Seafood", rating: 4.5, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Ã‡iya SofrasÄ±", cuisine: "Regional Turkish", rating: 4.4, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" }
    ],
    "Hong Kong": [
        { name: "Caprice", cuisine: "French", rating: 4.9, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Amber", cuisine: "French", rating: 4.8, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Lung King Heen", cuisine: "Cantonese", rating: 4.7, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Yardbird", cuisine: "Japanese Izakaya", rating: 4.5, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Otto e Mezzo Bombana", cuisine: "Italian", rating: 4.6, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" }
    ],
    "Mecca": [
        { name: "Al Baik", cuisine: "Fast Food (Chicken)", rating: 4.5, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "The Venue", cuisine: "International", rating: 4.4, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Al Tazaj", cuisine: "Arabic Chicken", rating: 4.3, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Al Shurafa", cuisine: "Middle Eastern", rating: 4.2, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Abu Jbara", cuisine: "Levantine", rating: 4.1, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" }
    ],
    "Dubai": [
        { name: "Pierchic", cuisine: "Seafood", rating: 4.8, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Armani/Ristorante", cuisine: "Italian", rating: 4.9, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Zuma", cuisine: "Japanese", rating: 4.7, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Ossiano", cuisine: "Fine Dining", rating: 4.6, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Al Fanar Restaurant", cuisine: "Emirati", rating: 4.5, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" }
    ],
    "Macau": [
        { name: "Robuchon au DÃ´me", cuisine: "French", rating: 5.0, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "The Eight", cuisine: "Cantonese", rating: 4.9, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Wing Lei Palace", cuisine: "Cantonese", rating: 4.8, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "A Lorcha", cuisine: "Macanese", rating: 4.6, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Antonio", cuisine: "Portuguese", rating: 4.5, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" }
    ],
    "Kuala Lumpur": [
        { name: "Dewakan", cuisine: "Modern Malaysian", rating: 4.8, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Cilantro", cuisine: "French-Japanese", rating: 4.7, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Marble 8", cuisine: "Steakhouse", rating: 4.6, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Bijan", cuisine: "Malay Fine Dining", rating: 4.5, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Hutong Food Court", cuisine: "Street Food", rating: 4.3, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" }
    ],
    "Seoul": [
        { name: "Mingles", cuisine: "Korean Contemporary", rating: 4.9, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Jungsik", cuisine: "New Korean", rating: 4.8, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "La Yeon", cuisine: "Traditional Korean", rating: 4.7, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Gwangjang Market", cuisine: "Street Food", rating: 4.5, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Tosokchon Samgyetang", cuisine: "Ginseng Chicken Soup", rating: 4.4, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" }
    ],
    "Beijing": [
        { name: "King's Joy", cuisine: "Vegetarian", rating: 4.8, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Temple Restaurant Beijing", cuisine: "European", rating: 4.7, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Da Dong Roast Duck", cuisine: "Peking Duck", rating: 4.6, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Jing Yaa Tang", cuisine: "Chinese", rating: 4.5, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Hutong Cuisine", cuisine: "Local Beijing", rating: 4.3, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" }
    ],
    "Shanghai": [
        { name: "Ultraviolet by Paul Pairet", cuisine: "Avant-garde", rating: 5.0, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Taian Table", cuisine: "Contemporary", rating: 4.9, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Jean-Georges", cuisine: "French", rating: 4.8, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Lost Heaven", cuisine: "Yunnan Cuisine", rating: 4.6, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Jian Guo 328", cuisine: "Local Shanghai", rating: 4.5, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" }
    ],
    "Lisbon": [
        { name: "Alma", cuisine: "Contemporary Portuguese", rating: 4.8, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Belcanto", cuisine: "Portuguese Fine Dining", rating: 4.9, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Prado", cuisine: "Farm to Table", rating: 4.6, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Time Out Market Lisboa", cuisine: "Variety", rating: 4.4, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Cervejaria Ramiro", cuisine: "Seafood", rating: 4.5, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" }
    ],
    "Prague": [
        { name: "La Degustation BohÃªme Bourgeoise", cuisine: "Czech Fine Dining", rating: 4.8, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Field", cuisine: "Modern European", rating: 4.7, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Eska", cuisine: "New Czech", rating: 4.6, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Sansho", cuisine: "Asian Fusion", rating: 4.5, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Lokal", cuisine: "Traditional Czech", rating: 4.4, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" }
    ],
    "Vienna": [
        { name: "Steirereck", cuisine: "Austrian Fine Dining", rating: 4.9, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Amador", cuisine: "Contemporary", rating: 4.8, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Zum Schwarzen Kameel", cuisine: "Traditional", rating: 4.6, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Plachutta", cuisine: "Tafelspitz", rating: 4.5, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "FiglmÃ¼ller", cuisine: "Schnitzel", rating: 4.4, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" }
    ],
    "Venice": [
        { name: "Quadri", cuisine: "Italian Fine Dining", rating: 4.8, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Local", cuisine: "Venetian", rating: 4.7, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Antiche Carampane", cuisine: "Seafood", rating: 4.6, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Osteria Alle Testiere", cuisine: "Seafood", rating: 4.5, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Al Covo", cuisine: "Venetian", rating: 4.4, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" }
    ],
    "Los Angeles": [
        { name: "Providence", cuisine: "Seafood", rating: 4.8, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "n/naka", cuisine: "Kaiseki", rating: 4.9, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Bestia", cuisine: "Italian", rating: 4.7, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Osteria Mozza", cuisine: "Italian", rating: 4.6, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "RÃ©publique", cuisine: "French", rating: 4.5, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" }
    ],
    "San Francisco": [
        { name: "The French Laundry", cuisine: "French", rating: 4.9, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Benu", cuisine: "Asian Fusion", rating: 4.8, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "State Bird Provisions", cuisine: "American Dim Sum", rating: 4.7, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Foreign Cinema", cuisine: "Mediterranean", rating: 4.5, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Zuni CafÃ©", cuisine: "American", rating: 4.4, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" }
    ],
    "Mexico City": [
        { name: "Pujol", cuisine: "Mexican Fine Dining", rating: 4.9, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Quintonil", cuisine: "Mexican", rating: 4.8, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Sud777", cuisine: "Mexican", rating: 4.7, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Contramar", cuisine: "Seafood", rating: 4.5, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "MÃ¡ximo Bistrot", cuisine: "Seasonal", rating: 4.6, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" }
    ],
    "Cairo": [
        { name: "Abou Tarek Koshary", cuisine: "Koshary", rating: 4.5, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Abou Shakra", cuisine: "Egyptian BBQ", rating: 4.4, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" },
        { name: "Zooba", cuisine: "Street Food", rating: 4.3, img: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400" },
        { name: "Felfela", cuisine: "Middle Eastern", rating: 4.2, img: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400" },
        { name: "Andrea Mariouteya", cuisine: "Local Egyptian", rating: 4.1, img: "https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400" }
    ]
};
// SFARSIT DATE RESTAURANTE EXTINSE

function getUsers(){ return JSON.parse(localStorage.getItem('users')||'[]'); }
function saveUsers(users){ localStorage.setItem('users', JSON.stringify(users)); }

function register(){
    const u=document.getElementById('reg-username').value.trim();
    const p=document.getElementById('reg-password').value.trim();
    const msg=document.getElementById('reg-msg');
    if(!u||!p){ msg.textContent="CompleteazÄƒ toate!"; return; }
    let users=getUsers();
    if(users.find(x=>x.username===u)){ msg.textContent="Username existent!"; return; }
    users.push({username:u,password:p});
    saveUsers(users);
    msg.style.color='green';
    msg.textContent="Cont creat! LogheazÄƒ-te.";
    showLogin(); 
}

function login(){
    const u=document.getElementById('login-username').value.trim();
    const p=document.getElementById('login-password').value.trim();
    const msg=document.getElementById('login-msg');
    let users=getUsers();
    let user=users.find(x=>x.username===u&&x.password===p);
    if(user){ 
        localStorage.setItem('currentUser',u); 
        showApp(); 
    } 
    else{ msg.textContent="Date greÈ™ite!"; }
}

function logout(){ 
    localStorage.removeItem('currentUser'); 
    document.getElementById('app-container').style.display='none'; 
    document.getElementById('auth-container').style.display='block'; 
}

function showRegister(){ 
    document.getElementById('register-form').style.display='block'; 
    document.getElementById('login-form').style.display='none'; 
    document.getElementById('reg-msg').textContent = "";
    document.getElementById('login-msg').textContent = "";
}

function showLogin(){ 
    document.getElementById('register-form').style.display='none'; 
    document.getElementById('login-form').style.display='block'; 
    document.getElementById('reg-msg').textContent = "";
    document.getElementById('login-msg').textContent = "";
}

function showApp(){
    const u=localStorage.getItem('currentUser');
    if(!u)return;
    document.getElementById('user-name').textContent=u;
    document.getElementById('auth-container').style.display='none';
    document.getElementById('app-container').style.display='block';
    initWorldMap();
    renderTripLists();
}

function storeGeneratedItinerary(city, days, data){
    currentCity = city;
    editableItinerary = [];
    allCityAttractions = [];
    currentTripIndex = null;
    isViewingTrip = false;
    
    for(let i=1; i<=days; i++){
        const dayIndex=(i-1)%data[city].length;
        // AsigurÄƒ-te cÄƒ adaugi o copie a listei pentru a permite modificÄƒri locale
        editableItinerary.push(JSON.parse(JSON.stringify(data[city][dayIndex])));
    }
    
    data[city].forEach(dayList => {
        dayList.forEach(attraction => {
            if(!allCityAttractions.some(a => a.activity === attraction.activity)){
                allCityAttractions.push(attraction);
            }
        });
    });
}

function generateItinerary(){
    const city=document.getElementById("city").value;
    const days=parseInt(document.getElementById("days").value);
    const out=document.getElementById("output");
    
    showRestaurants(city);
    
    // ÃncarcÄƒ data.json - notÄƒ: aceastÄƒ metodÄƒ necesitÄƒ ca data.json sÄƒ existe È™i sÄƒ fie accesibil
    fetch('data.json')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            if(!data[city] || data[city].length === 0){ 
                out.innerHTML='<p>Nu existÄƒ date de itinerariu pentru acest oraÈ™.</p>'; 
                return; 
            }
            
            storeGeneratedItinerary(city, days, data);
            renderUpdatedItinerary();
            
            if(editableItinerary[0] && editableItinerary[0].length > 0){
                showMap(editableItinerary[0]);
            } else {
                initWorldMap();
            }
            
            setTimeout(() => {
                const daysEls = document.querySelectorAll('.day');
                daysEls.forEach((dayEl, index) => {
                    setTimeout(() => { dayEl.classList.add('show'); }, index * 150);
                    
                    dayEl.removeEventListener('click', mapDayClickHandler); 
                    dayEl.addEventListener('click', () => mapDayClickHandler(index));
                });
            }, 100);
        })
        .catch(err => {
            console.error("Eroare la generarea itinerariului:", err);
            out.innerHTML='<p>Eroare la Ã®ncÄƒrcarea datelor: ' + err.message + '</p>';
        });
}

function mapDayClickHandler(dayIndex) {
    if (editableItinerary[dayIndex] && editableItinerary[dayIndex].length > 0) {
        showMap(editableItinerary[dayIndex]);
    } else {
        alert("Nicio atracÈ›ie pentru aceastÄƒ zi de afiÈ™at pe hartÄƒ.");
    }
}

// FUNCÈšIA PENTRU ACTUALIZAREA OREI (RÄ‚SPUNSUL ANTERIOR)
function updateObjectiveTime(day, index, newTime) {
    
    const dayIndex = day - 1;
    
    // Validare simplÄƒ
    if (!newTime) {
        alert("Ora nu poate fi goalÄƒ! VÄƒ rugÄƒm introduceÈ›i o orÄƒ validÄƒ.");
        
        renderUpdatedItinerary(); 
        return;
    }
    
    
    editableItinerary[dayIndex][index].time = newTime;
    
    
    sortDayByTime(dayIndex);
    
    
    renderUpdatedItinerary();
}

function addObjective(day){
    const select = document.querySelector(`.add-objective-select[data-day="${day}"]`);
    const value = select.value;
    if(!value) return;
    
    const attraction = allCityAttractions.find(a => a.activity === value);
    if(attraction){
        const exists = editableItinerary[day-1].find(obj => obj.activity === attraction.activity);
        if(exists) {
            alert("Acest obiectiv existÄƒ deja Ã®n aceastÄƒ zi!");
            select.value = "";
            return;
        }
        
        
        editableItinerary[day-1].push({
            time: attraction.time,
            activity: attraction.activity,
            lat: attraction.lat,
            lng: attraction.lng
        });
        
        
        sortDayByTime(day-1);
    }
    
    renderUpdatedItinerary();
    select.value = "";
}

function moveObjective(fromDay, index, toDay){
    
    toDay = parseInt(toDay);
    if(isNaN(toDay) || toDay < 1 || toDay > editableItinerary.length || fromDay === toDay) return;
    
    const item = editableItinerary[fromDay-1].splice(index, 1)[0];
    editableItinerary[toDay-1].push(item);
    
    sortDayByTime(toDay-1);
    
    renderUpdatedItinerary();
}

function deleteObjective(day, index) {
    if(confirm("Sigur vrei sÄƒ È™tergi acest obiectiv?")) {
        editableItinerary[day-1].splice(index, 1);
        renderUpdatedItinerary();
    }
}

function sortDayByTime(dayIndex) {
    editableItinerary[dayIndex].sort((a, b) => {
        const timeA = parseTime(a.time);
        const timeB = parseTime(b.time);
        return timeA - timeB;
    });
}

function parseTime(timeStr) {
    
    if (timeStr === "Custom" || !timeStr) return 9999; 
    
    const match = timeStr.match(/(\d{1,2}):(\d{2})/);
    if (!match) return 9999;
    
    const hours = parseInt(match[1]);
    const minutes = parseInt(match[2]);
    return hours * 60 + minutes;
}

function renderUpdatedItinerary(){
    const out = document.getElementById("output");
    const isPast = isViewingTrip && isTripPast(currentTripIndex);
    
    let html = `<h2>Itinerariu pentru ${currentCity}</h2>`;

    
    if (isViewingTrip) {
        if (!isPast) {
            html += `<button class="generate-btn" onclick="saveModifications()" style="margin-bottom:20px;">ğŸ’¾ SalveazÄƒ ModificÄƒrile</button>`;
        } else {
            html += `<div style="padding:15px; background:#ff9800; color:white; border-radius:10px; margin-bottom:20px; text-align:center;">
                        <strong>âš  AceastÄƒ cÄƒlÄƒtorie a trecut - Nu poate fi modificatÄƒ</strong>
                    </div>`;
        }
    } else {
        html += `<button class="generate-btn" onclick="saveModifications()" style="margin-bottom:20px;">ğŸ’¾ SalveazÄƒ ModificÄƒrile</button>`;
    }
    
    for(let d=0; d<editableItinerary.length; d++){
        
        html += `
        <div class="day show">
            <h3>Ziua ${d+1}</h3>`;
        
        if (!isPast) {
            html += `
            <div class="edit-controls">
                <select class="add-objective-select" data-day="${d+1}">
                    <option value="">SelecteazÄƒ obiectiv...</option>
                    ${allCityAttractions.map(attr => `<option value="${attr.activity}">${attr.time} - ${attr.activity}</option>`).join('')}
                </select>
                <button class="add-objective-btn" onclick="addObjective(${d+1})">AdaugÄƒ</button>
            </div>`;
        }
            
        html += `<ul class="objectives">
                ${editableItinerary[d].map((a, idx) => `
                    <li>
                        <div style="display:inline-flex; align-items:center; gap:10px; min-width: 250px;">
                            ${!isPast ? 
                                
                                `<input type="time" value="${a.time}" onchange="updateObjectiveTime(${d+1}, ${idx}, this.value)" style="padding:5px; border-radius:5px; border:1px solid #e0e0e0; font-size:14px; color:#764ba2; font-weight:bold; margin-right: 5px;">` :
                                
                                `<span class="time">${a.time}</span>`
                            } 
                            <span>${a.activity}</span>
                        </div>
                        <div style="float:right; display:flex; gap:5px; align-items:center;">
                            ${!isPast ? `
                                <select class="move-select" onchange="moveObjective(${d+1}, ${idx}, this.value)">
                                    <option value="">MutÄƒ Ã®n zi...</option>
                                    ${editableItinerary.map((_, di) => `<option value="${di+1}">Ziua ${di+1}</option>`).join('')}
                                </select>
                                <button onclick="deleteObjective(${d+1}, ${idx})" style="background:#ff5252; color:white; border:none; padding:4px 8px; border-radius:5px; cursor:pointer; font-size:14px;">ğŸ—‘</button>
                            ` : ''}
                        </div>
                    </li>
                `).join("")}
            </ul>
        </div>`;
    }
    
    out.innerHTML = html;
    
    
    setTimeout(() => {
        const daysEls = document.querySelectorAll('.day');
        daysEls.forEach((dayEl, index) => {
            dayEl.removeEventListener('click', mapDayClickHandler);
            dayEl.addEventListener('click', () => mapDayClickHandler(index));
        });
    }, 100);
}

function saveModifications(){
    if (isViewingTrip && currentTripIndex !== null) {
        updateExistingTrip(currentTripIndex);
        alert(`ModificÄƒrile pentru cÄƒlÄƒtoria ${currentCity} au fost salvate!`);
    } else if (currentCity) {
        
        alert(`ModificÄƒrile pentru itinerariul curent ${currentCity} au fost salvate (temporar). SalvaÈ›i cÄƒlÄƒtoria pentru a o pÄƒstra!`);
    } else {
        alert("Nu este generat niciun itinerariu pentru a fi salvat.");
    }

}

function updateExistingTrip(index) {
    const trips = JSON.parse(localStorage.getItem("trips") || "[]");
    if (trips[index] && !isTripPast(index)) { // Se asigurÄƒ cÄƒ nu salveazÄƒ modificÄƒri la cele trecute
        trips[index].itinerary = JSON.parse(JSON.stringify(editableItinerary));
        trips[index].lastModified = new Date().toISOString();
        localStorage.setItem("trips", JSON.stringify(trips));
        renderTripLists();
    } else if (isTripPast(index)) {
         alert("Nu se pot salva modificÄƒri pentru o cÄƒlÄƒtorie trecutÄƒ!");
    }
}

function showMap(dayActivities){
    if(map) map.remove();
    
    const firstLat = dayActivities[0]?.lat || 48.8566;
    const firstLng = dayActivities[0]?.lng || 2.3522;
    
    map = L.map('map').setView([firstLat, firstLng], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);
    
    dayActivities.forEach(act => {
        if(act.lat && act.lng){
            L.marker([act.lat, act.lng]).addTo(map).bindPopup(act.activity);
        }
    });
}

function showRestaurants(city) {
    const section = document.getElementById('restaurantsSection');
    const citySpan = document.getElementById('selectedCity');
    const list = document.getElementById('restaurantsList');
    
    citySpan.textContent = city;
    const restaurants = restaurantsData[city] || [];
    
    if (restaurants.length === 0) {
        section.style.display = 'none';
        return;
    }
    
    section.style.display = 'block';
    list.innerHTML = '';
    
    restaurants.forEach(rest => {
        const stars = 'â­'.repeat(Math.floor(rest.rating));
        
    
        const searchQuery = encodeURIComponent(`${rest.name} ${city}`);
        const searchUrl = `https://www.google.com/search?q=${searchQuery}`;
        
        
        const cardLink = document.createElement('a');
        cardLink.href = searchUrl;
        cardLink.target = "_blank"; // Deschide Ã®n tab nou
        cardLink.className = 'restaurant-card'; // FoloseÈ™te clasa existentÄƒ pentru stilizare
        
       
        cardLink.innerHTML = `
            <img src="${rest.img}" class="restaurant-img" alt="${rest.name}">
            <div class="restaurant-info">
                <div class="restaurant-name">${rest.name}</div>
                <div class="restaurant-cuisine">${rest.cuisine}</div>
                <div><span class="stars">${stars}</span> ${rest.rating}</div>
            </div>
        `;
        list.appendChild(cardLink);
    });
}

function initWorldMap() {
    if(map) map.remove();
    map = L.map('map').setView([20, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
}

function toggleTheme(){
    const cur=document.body.getAttribute("data-theme");
    document.body.setAttribute("data-theme", cur==='dark'?'light':'dark');
}

const historyBtn = document.getElementById("historyBtn");
const rightMenu = document.getElementById("rightMenu");
const closeMenuBtn = document.getElementById("closeMenuBtn");

historyBtn.addEventListener("click", () => {
    rightMenu.style.display = rightMenu.style.display === 'block' ? 'none' : 'block';
    if(rightMenu.style.display === 'block') {
        renderTripLists();
    }
});

closeMenuBtn.addEventListener("click", () => {
    rightMenu.style.display = 'none';
});

function saveCurrentTrip() {
    if (!currentCity || editableItinerary.length === 0) {
        alert("GenereazÄƒ mai Ã®ntÃ¢i un itinerariu!");
        return;
    }
    
    
    const defaultDate = new Date().toISOString().split('T')[0];
    const tripDateInput = prompt("Introdu data cÄƒlÄƒtoriei (YYYY-MM-DD):", defaultDate);
    
    if (!tripDateInput) return;

    
    if (!/^\d{4}-\d{2}-\d{2}$/.test(tripDateInput)) {
        alert("Formatul datei este invalid. FoloseÈ™te YYYY-MM-DD.");
        return;
    }
    
    const trip = {
        city: currentCity,
        days: editableItinerary.length,
        itinerary: JSON.parse(JSON.stringify(editableItinerary)),
        tripDate: tripDateInput,
        savedDate: new Date().toISOString()
    };

    let trips = JSON.parse(localStorage.getItem("trips") || "[]");
    trips.push(trip);
    localStorage.setItem("trips", JSON.stringify(trips));

    renderTripLists();
    alert(`Trip salvat: ${trip.city} - ${trip.tripDate}`);
}

function isTripPast(index) {
    const trips = JSON.parse(localStorage.getItem("trips") || "[]");
    if (!trips[index] || !trips[index].tripDate) return false;
    
    const tripDate = new Date(trips[index].tripDate);
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    return tripDate < today;
}

function renderTripLists() {
    const trips = JSON.parse(localStorage.getItem("trips") || "[]");
    const pastList = document.getElementById("pastTripsList");
    const futureList = document.getElementById("futureTripsList");

    pastList.innerHTML = "";
    futureList.innerHTML = "";
    
   
    trips.sort((a, b) => new Date(a.tripDate) - new Date(b.tripDate));

    trips.forEach((trip, index) => {
        const isPast = isTripPast(index);
        
        const li = document.createElement("li");
        li.style.cssText = "padding:10px; background:#f0f0f0; margin:5px 0; border-radius:8px; cursor:pointer;";
        
        const badge = isPast ? 
            '<span class="trip-badge badge-past">TRECUT</span>' : 
            '<span class="trip-badge badge-future">VIITOR</span>';
        
        li.innerHTML = `
            <strong>${trip.city}</strong> ${badge}<br>
            <small>ğŸ“… ${trip.tripDate}</small><br>
            <small>ğŸ—º ${trip.days} zile</small>
        `;

        li.onclick = () => openTrip(index);
        
        const deleteBtn = document.createElement("button");
        deleteBtn.innerHTML = "ğŸ—‘";
        deleteBtn.style.cssText = "float:right; background:#ff5252; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer; margin-left:10px;";
        deleteBtn.onclick = (e) => {
            e.stopPropagation();
            deleteTrip(index);
        };
        li.appendChild(deleteBtn);

        if (isPast) {
            pastList.appendChild(li);
        } else {
            futureList.appendChild(li);
        }
    });
}

function openTrip(index) {
    const trips = JSON.parse(localStorage.getItem("trips") || "[]");
    if (!trips[index]) return;
    
    const trip = trips[index];
    
    currentCity = trip.city;
    
    editableItinerary = JSON.parse(JSON.stringify(trip.itinerary)); 
    currentTripIndex = index;
    isViewingTrip = true;
    

    fetch('data.json')
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            if (data[trip.city]) {
                allCityAttractions = [];
                data[trip.city].forEach(dayList => {
                    dayList.forEach(attraction => {
                        
                        if(!allCityAttractions.some(a => a.activity === attraction.activity)){
                            allCityAttractions.push(attraction);
                        }
                    });
                });
            }
            
            renderUpdatedItinerary();
            showRestaurants(trip.city);
            
            if (editableItinerary[0] && editableItinerary[0].length > 0) {
                showMap(editableItinerary[0]);
            } else {
                initWorldMap();
            }
            
            document.getElementById("rightMenu").style.display = 'none';
            
            setTimeout(() => {
                const daysEls = document.querySelectorAll('.day');
                daysEls.forEach((dayEl, idx) => {
                    dayEl.addEventListener('click', () => { 
                        showMap(editableItinerary[idx]); 
                    });
                });
            }, 100);
        })
        .catch(err => {
             console.error("Eroare la deschiderea cÄƒlÄƒtoriei:", err);
            document.getElementById("output").innerHTML='<p>Eroare la Ã®ncÄƒrcarea datelor cÄƒlÄƒtoriei: ' + err.message + '</p>';
        });
}

function deleteTrip(index) {
    if (!confirm("Sigur vrei sÄƒ È™tergi aceastÄƒ cÄƒlÄƒtorie?")) return;
    
    let trips = JSON.parse(localStorage.getItem("trips") || "[]");
    
    trips.splice(index, 1);
    localStorage.setItem("trips", JSON.stringify(trips));
    
    
    if (index === currentTripIndex) {
        currentTripIndex = null;
        isViewingTrip = false;
    }
    
    renderTripLists();
}

function addTodo() {
    const input = document.getElementById("todoInput");
    const task = input.value.trim();
    if (!task) return;
    const list = document.getElementById("toDoList");
    const li = document.createElement("li");
    
    li.innerHTML = `<span><input type="checkbox"> ${task}</span>
        <button onclick="this.closest('li').remove()" style="background:#ff5252; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">ğŸ—‘</button>`;
    list.appendChild(li);
    input.value = "";
}

document.getElementById("todoInput")?.addEventListener("keypress", (e) => {
    if (e.key === "Enter") addTodo();
});

document.querySelectorAll('.faq-question').forEach(btn => {
    btn.addEventListener('click', () => {
        const answer = btn.nextElementSibling;
        
        answer.style.display = answer.style.display === 'block' ? 'none' : 'block';
    });
});

window.onload=()=>{
    const u=localStorage.getItem('currentUser');
    if(u) showApp();
};

</script>
</body>
</html>