<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CulturalMap - Itinerar Cultural</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="style.css">
</head>
<body data-theme="light">

<header>
    <div class="logo">CulturalMap</div>
    <button class="toggle-theme" onclick="toggleTheme()">ðŸŒ™</button>
</header>

<div class="container" id="auth-container">
    <div id="register-form">
        <h2>ÃŽnregistrare</h2>
        <input type="text" id="reg-username" placeholder="Username"><br><br>
        <input type="password" id="reg-password" placeholder="Parola"><br><br>
        <button onclick="register()">ÃŽnregistreazÄƒ-te</button>
        <p>Ai deja cont? <a href="#" onclick="showLogin()">LogheazÄƒ-te aici</a></p>
        <p id="reg-msg" style="color:red"></p>
    </div>

    <div id="login-form" style="display:none;">
        <h2>Login</h2>
        <input type="text" id="login-username" placeholder="Username"><br><br>
        <input type="password" id="login-password" placeholder="Parola"><br><br>
        <button onclick="login()">Login</button>
        <p>Nu ai cont? <a href="#" onclick="showRegister()">ÃŽnregistreazÄƒ-te aici</a></p>
        <p id="login-msg" style="color:red"></p>
    </div>
</div>

<div class="container" id="app-container" style="display:none;">
    <h2>Bun venit, <span id="user-name"></span>! <button onclick="logout()">Logout</button></h2>

    <label for="city">Alege oraÈ™ul</label>
    <select id="city">
        <option value="Paris">Paris</option>
        <option value="Madrid">Madrid</option>
        <option value="Tokyo">Tokyo</option>
        <option value="Rome">Rome</option>
        <option value="Milan">Milan</option>
        <option value="New York">New York</option>
        <option value="Amsterdam">Amsterdam</option>
        <option value="Sydney">Sydney</option>
        <option value="Singapore">Singapore</option>
        <option value="Barcelona">Barcelona</option>
        <option value="Bangkok">Bangkok</option>
        <option value="Istanbul">Istanbul</option>
        <option value="London">London</option>
        <option value="Hong Kong">Hong Kong</option>
        <option value="Mecca">Mecca</option>
        <option value="Dubai">Dubai</option>
        <option value="Macau">Macau</option>
        <option value="Kuala Lumpur">Kuala Lumpur</option>
        <option value="Seoul">Seoul</option>
        <option value="Beijing">Beijing</option>
        <option value="Shanghai">Shanghai</option>
        <option value="Lisbon">Lisbon</option>
        <option value="Prague">Prague</option>
        <option value="Vienna">Vienna</option>
        <option value="Venice">Venice</option>
        <option value="Los Angeles">Los Angeles</option>
        <option value="San Francisco">San Francisco</option>
        <option value="Mexico City">Mexico City</option>
        <option value="Cairo">Cairo</option>
    </select>

    <label for="days">NumÄƒr de zile</label>
    <input type="number" id="days" min="1" max="14" value="3" />
    <button onclick="generateItinerary()">GenereazÄƒ Itinerariul</button>

    <div id="output" class="itinerary"></div>

    <div id="map" style="height:450px; margin-top:20px;"></div>

    <!-- RECOMANDÄ‚RI MUTATE AICI -->
    <div id="recommendations" style="margin-top:25px;"></div>

    <div id="faq">
        <h2>ÃŽntrebÄƒri frecvente</h2>
        <div class="faq-item">
            <button class="faq-question">Cum aleg numÄƒrul de zile?</button>
            <div class="faq-answer">NumÄƒrul de zile depinde de timpul tÄƒu disponibil È™i ce obiective vrei sÄƒ vizitezi.</div>
        </div>
        <div class="faq-item">
            <button class="faq-question">Pot adÄƒuga obiective proprii?</button>
            <div class="faq-answer">Da, poÈ›i edita JSON-ul sau Ã®n viitor putem adÄƒuga un formular de input.</div>
        </div>
    </div>

<!-- Buton hamburger -->
<div id="hamburgerBtn" style="position:fixed; top:10px; right:10px; font-size:30px; cursor:pointer; z-index:1000;">
    â˜°
</div>

<!-- Meniu lateral ascuns -->
<div id="rightMenu" style="position:fixed; top:0; right:-320px; width:300px; height:100%; background:#f9f9f9; box-shadow:-2px 0 5px rgba(0,0,0,0.3); padding:20px; transition: right 0.3s; z-index:999;">
    <h2>Profil utilizator</h2>
    <select id="userSelect">
        <option value="">SelecteazÄƒ cont</option>
    </select>

    <div id="pastTripsSection">
        <h3>CÄƒlÄƒtoriile trecute</h3>
        <ul id="pastTripsList"></ul>
    </div>

    <div id="toDoSection">
        <h3>To Do List</h3>
        <ul id="toDoList"></ul>
    </div>
</div>

</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let map
// ==== LOGIN & REGISTER ====
function getUsers(){ return JSON.parse(localStorage.getItem('users')||'[]'); }
function saveUsers(users){ localStorage.setItem('users', JSON.stringify(users)); }

function register(){
    const u=document.getElementById('reg-username').value.trim();
    const p=document.getElementById('reg-password').value.trim();
    const msg=document.getElementById('reg-msg');
    if(!u||!p){ msg.textContent="CompleteazÄƒ toate cÃ¢mpurile!"; return; }
    let users=getUsers();
    if(users.find(x=>x.username===u)){ msg.textContent="Username deja existent!"; return; }
    users.push({username:u,password:p});
    saveUsers(users);
    msg.style.color='green';
    msg.textContent="Cont creat cu succes! Te poÈ›i loga acum.";
}

function login(){
    const u=document.getElementById('login-username').value.trim();
    const p=document.getElementById('login-password').value.trim();
    const msg=document.getElementById('login-msg');
    let users=getUsers();
    let user=users.find(x=>x.username===u&&x.password===p);
    if(user){ localStorage.setItem('currentUser',u); showApp(); } 
    else{ msg.textContent="Username sau parola greÈ™itÄƒ!"; }
}

function logout(){ localStorage.removeItem('currentUser'); document.getElementById('app-container').style.display='none'; document.getElementById('auth-container').style.display='block'; }
function showRegister(){ document.getElementById('register-form').style.display='block'; document.getElementById('login-form').style.display='none'; }
function showLogin(){ document.getElementById('register-form').style.display='none'; document.getElementById('login-form').style.display='block'; }
function showApp(){
    const u=localStorage.getItem('currentUser');
    if(!u)return;
    document.getElementById('user-name').textContent=u;
    document.getElementById('auth-container').style.display='none';
    document.getElementById('app-container').style.display='block';

    // InitializeazÄƒ harta lumii imediat dupÄƒ login
    initWorldMap();
}
// ==== ITINERARY ====
async function generateItinerary(){
    const city=document.getElementById("city").value;
    const days=parseInt(document.getElementById("days").value);
    const out=document.getElementById("output");
    showRecommendations(city);
    try{
        const response=await fetch('data.json');
        const data=await response.json();
        if(!data[city]){ out.innerHTML='<p>Nu existÄƒ date pentru acest oraÈ™.</p>'; return; }
        let html=`<h2>Itinerariu pentru ${city}</h2>`;
        for(let i=1;i<=days;i++){
            const dayIndex=(i-1)%data[city].length;
            const dayActivities=data[city][dayIndex];
            html+=`<div class="day">
                <h3>Ziua ${i}</h3>
                <ul class="objectives">${dayActivities.map(a=>`<li><span class='time'>${a.time}</span> ${a.activity}</li>`).join('')}</ul>
            </div>`;
        }
        out.innerHTML=html;

        // animaÈ›ii fade + slide-up
        const daysEls = document.querySelectorAll('.day');
        daysEls.forEach((dayEl,index)=>{
            setTimeout(()=>{ dayEl.classList.add('show'); }, index*150);
            // click pe card pentru harta
            const dayIndex=(index)%data[city].length;
            dayEl.addEventListener('click',()=>{ showMap(data[city][dayIndex]); });
        });
    }catch(err){ console.error(err); out.innerHTML='<p>Eroare la Ã®ncÄƒrcarea datelor.</p>'; }
}

function showRecommendations(city, day) {
    const recOut = document.getElementById('recommendations');
    recOut.innerHTML = ""; // golim Ã®nainte de a afiÈ™a

    fetch('data.json')
        .then(response => {
            if (!response.ok) throw new Error('Nu s-a putut Ã®ncÄƒrca data.json');
            return response.json();
        })
        .then(data => {
            // presupunem structura: { "Paris": { "Ziua 1": ["rec1", "rec2"], ... }, "Roma": {...} }
            const recs = data[city]?.[day];
            if (!recs || recs.length == 0) {
                recOut.innerHTML = `<p>Nu existÄƒ recomandÄƒri pentru ${city} Ã®n ${day}</p>`;
                return;
            }
            recOut.innerHTML = `<h3>RecomandÄƒri pentru ${city}, ${day}</h3>
                                <ul>${recs.map(r => `<li>${r}</li>`).join('')}</ul>`;
        })
        .catch(error => {
            console.error(error);
            recOut.innerHTML = `<p>Eroare la Ã®ncÄƒrcarea recomandÄƒrilor.</p>`;
        });
}



function showMap(dayActivities){
    const mapDiv = document.getElementById('map');

    // distruge harta veche dacÄƒ existÄƒ
    if(map) {
        map.remove();
    }

    // alege prima locaÈ›ie ca centru
    const firstLat = dayActivities[0]?.lat || 48.8566;
    const firstLng = dayActivities[0]?.lng || 2.3522;

    map = L.map('map').setView([firstLat, firstLng], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // adaugÄƒ marker-ele
    dayActivities.forEach(act => {
        if(act.lat && act.lng){
            L.marker([act.lat, act.lng]).addTo(map).bindPopup(act.activity);
        }
    });
}

// ==== DARK MODE ====
function toggleTheme(){
    const cur=document.body.getAttribute("data-theme");
    document.body.setAttribute("data-theme", cur==='dark'?'light':'dark');
}

function initWorldMap() {
    const mapDiv = document.getElementById('map');

    if (map) {
        map.remove();
    }

    // Harta lumii
    map = L.map('map').setView([20, 0], 2); 

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);
}

// ==== FAQ ====
document.addEventListener('DOMContentLoaded',()=>{ document.querySelectorAll('.faq-question').forEach(btn=>{
    btn.addEventListener('click',()=>{ const ans=btn.nextElementSibling; ans.style.display=ans.style.display==='block'?'none':'block'; }); });
});
// ==== FAQ POPUP ====


document.getElementById('generateBtn').addEventListener('click', () => {
    const city = document.getElementById('citySelect').value;
    const day = document.getElementById('daySelect').value;

    if (!city || !day) {
        alert("SelecteazÄƒ oraÈ™ul È™i ziua!");
        return;
    }

    showRecommendations(city, day);
    showMap(city, day);
});

// Ã®ntrebÄƒrile se deschid/Ã®nchid
document.querySelectorAll('.faq-question').forEach(btn => {
    btn.addEventListener('click', () => {
        const answer = btn.nextElementSibling;
        answer.style.display = answer.style.display === 'block' ? 'none' : 'block';
    });
});



// ==== INIT ====
window.onload=showApp;
</script>
</body>
</html>
