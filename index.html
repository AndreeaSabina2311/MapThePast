<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MapThePast - Itinerar Cultural</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="style.css">
</head>
<body data-theme="light">

<header style="position: relative;">
    <div class="logo">CulturalMap</div>

    <button class="toggle-theme" onclick="toggleTheme()">ğŸŒ™</button>

    <!-- BUTON HISTORY & TODO -->
    <button id="historyBtn" 
            style="position:absolute; top:15px; right:20px; 
                   padding:10px 15px; background:#4CAF50; color:white; 
                   border:none; border-radius:5px; cursor:pointer; 
                   font-size:14px; z-index:1000;">
        ğŸ“‹ Trips & To-Do
    </button>
</header>

<div class="container" id="auth-container">
    <div id="register-form">
        <h2>Ãnregistrare</h2>
        <input type="text" id="reg-username" placeholder="Username"><br><br>
        <input type="password" id="reg-password" placeholder="Parola"><br><br>
        <button onclick="register()">ÃnregistreazÄƒ-te</button>
        <p>Ai deja cont? <a href="#" onclick="showLogin()">LogheazÄƒ-te aici</a></p>
        <p id="reg-msg" style="color:red"></p>
    </div>

    <div id="login-form" style="display:none;">
        <h2>Login</h2>
        <input type="text" id="login-username" placeholder="Username"><br><br>
        <input type="password" id="login-password" placeholder="Parola"><br><br>
        <button onclick="login()">Login</button>
        <p>Nu ai cont? <a href="#" onclick="showRegister()">ÃnregistreazÄƒ-te aici</a></p>
        <p id="login-msg" style="color:red"></p>
    </div>
</div>

<div class="container" id="app-container" style="display:none;">
    <h2>Bun venit, <span id="user-name"></span>! <button onclick="logout()">Logout</button></h2>

    <label for="city">Alege oraÈ™ul</label>
    <select id="city">
        <option value="Paris">Paris</option>
        <option value="Madrid">Madrid</option>
        <option value="Tokyo">Tokyo</option>
        <option value="Rome">Rome</option>
        <option value="Milan">Milan</option>
        <option value="New York">New York</option>
        <option value="Amsterdam">Amsterdam</option>
        <option value="Sydney">Sydney</option>
        <option value="Singapore">Singapore</option>
        <option value="Barcelona">Barcelona</option>
        <option value="Bangkok">Bangkok</option>
        <option value="Istanbul">Istanbul</option>
        <option value="London">London</option>
        <option value="Hong Kong">Hong Kong</option>
        <option value="Mecca">Mecca</option>
        <option value="Dubai">Dubai</option>
        <option value="Macau">Macau</option>
        <option value="Kuala Lumpur">Kuala Lumpur</option>
        <option value="Seoul">Seoul</option>
        <option value="Beijing">Beijing</option>
        <option value="Shanghai">Shanghai</option>
        <option value="Lisbon">Lisbon</option>
        <option value="Prague">Prague</option>
        <option value="Vienna">Vienna</option>
        <option value="Venice">Venice</option>
        <option value="Los Angeles">Los Angeles</option>
        <option value="San Francisco">San Francisco</option>
        <option value="Mexico City">Mexico City</option>
        <option value="Cairo">Cairo</option>
    </select>

    <label for="days">NumÄƒr de zile</label>
    <input type="number" id="days" min="1" max="14" value="3" />
    <button onclick="generateItinerary()">GenereazÄƒ Itinerariul</button>

    <div id="output" class="itinerary"></div>

    <div id="map" style="height:450px; margin-top:20px;"></div>

    <!-- RECOMANDÄ‚RI MUTATE AICI -->
    <div id="recommendations" style="margin-top:25px;"></div>

    <div id="faq">
        <h2>ÃntrebÄƒri frecvente</h2>
        <div class="faq-item">
            <button class="faq-question">Cum aleg numÄƒrul de zile?</button>
            <div class="faq-answer">NumÄƒrul de zile depinde de timpul tÄƒu disponibil È™i ce obiective vrei sÄƒ vizitezi.</div>
        </div>
        <div class="faq-item">
            <button class="faq-question">Pot adÄƒuga obiective proprii?</button>
            <div class="faq-answer">Da, poÈ›i edita JSON-ul sau Ã®n viitor putem adÄƒuga un formular de input.</div>
        </div>
    </div>

<!-- Meniu lateral pentru History & To-Do -->
<div id="rightMenu" style="display:none; position:fixed; top:0; right:0; width:320px; height:100%; background:#fff; box-shadow:-2px 0 10px rgba(0,0,0,0.3); padding:20px; z-index:999; overflow-y:auto;">
    <button id="closeMenuBtn" style="float:right; background:#ff5252; color:white; border:none; padding:5px 10px; border-radius:3px; cursor:pointer;">âœ•</button>
    <h2 style="margin-top:0;">My Travel Hub</h2>
    
    <div id="pastTripsSection" style="margin-bottom:30px;">
        <h3>ğŸ“ Last Trips</h3>
        <ul id="pastTripsList" style="list-style:none; padding:0;">
            <li style="padding:10px; background:#f0f0f0; margin-bottom:8px; border-radius:5px;">
                <strong>Paris</strong> - 3 days<br>
                <small>Oct 2024</small>
            </li>
            <li style="padding:10px; background:#f0f0f0; margin-bottom:8px; border-radius:5px;">
                <strong>Rome</strong> - 5 days<br>
                <small>Sep 2024</small>
            </li>
        </ul>
        <button onclick="saveCurrentTrip()" style="padding:8px 12px; background:#2196F3; color:white; border:none; border-radius:5px; cursor:pointer; width:100%;">
            ğŸ’¾ Save Current Trip
        </button>
    </div>

    <div id="toDoSection">
        <h3>âœ… To-Do List</h3>
        <input type="text" id="todoInput" placeholder="Add new task..." style="width:calc(100% - 60px); padding:8px; border:1px solid #ccc; border-radius:3px;">
        <button onclick="addTodo()" style="padding:8px 12px; background:#4CAF50; color:white; border:none; border-radius:3px; cursor:pointer;">+</button>
        <ul id="toDoList" style="list-style:none; padding:0; margin-top:15px;">
            <li style="padding:8px; background:#fff3cd; margin-bottom:5px; border-radius:3px; border-left:3px solid #ffc107;">
                <input type="checkbox"> Book flights
            </li>
            <li style="padding:8px; background:#fff3cd; margin-bottom:5px; border-radius:3px; border-left:3px solid #ffc107;">
                <input type="checkbox"> Reserve hotels
            </li>
        </ul>
    </div>
</div>

</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let map
// ==== LOGIN & REGISTER ====
function getUsers(){ return JSON.parse(localStorage.getItem('users')||'[]'); }
function saveUsers(users){ localStorage.setItem('users', JSON.stringify(users)); }

function register(){
    const u=document.getElementById('reg-username').value.trim();
    const p=document.getElementById('reg-password').value.trim();
    const msg=document.getElementById('reg-msg');
    if(!u||!p){ msg.textContent="CompleteazÄƒ toate cÃ¢mpurile!"; return; }
    let users=getUsers();
    if(users.find(x=>x.username===u)){ msg.textContent="Username deja existent!"; return; }
    users.push({username:u,password:p});
    saveUsers(users);
    msg.style.color='green';
    msg.textContent="Cont creat cu succes! Te poÈ›i loga acum.";
}

function login(){
    const u=document.getElementById('login-username').value.trim();
    const p=document.getElementById('login-password').value.trim();
    const msg=document.getElementById('login-msg');
    let users=getUsers();
    let user=users.find(x=>x.username===u&&x.password===p);
    if(user){ localStorage.setItem('currentUser',u); showApp(); } 
    else{ msg.textContent="Username sau parola greÈ™itÄƒ!"; }
}

function logout(){ localStorage.removeItem('currentUser'); document.getElementById('app-container').style.display='none'; document.getElementById('auth-container').style.display='block'; }
function showRegister(){ document.getElementById('register-form').style.display='block'; document.getElementById('login-form').style.display='none'; }
function showLogin(){ document.getElementById('register-form').style.display='none'; document.getElementById('login-form').style.display='block'; }
function showApp(){
    const u=localStorage.getItem('currentUser');
    if(!u)return;
    document.getElementById('user-name').textContent=u;
    document.getElementById('auth-container').style.display='none';
    document.getElementById('app-container').style.display='block';

    // InitializeazÄƒ harta lumii imediat dupÄƒ login
    initWorldMap();

    // AsigurÄƒ-te cÄƒ meniul e Ã®nchis la login
    document.getElementById('rightMenu').style.display = "none";
}
// ==== ITINERARY ====
async function generateItinerary(){
    const city=document.getElementById("city").value;
    const days=parseInt(document.getElementById("days").value);
    const out=document.getElementById("output");
    showRecommendations(city);
    try{
        const response=await fetch('data.json');
        const data=await response.json();
        if(!data[city]){ out.innerHTML='<p>Nu existÄƒ date pentru acest oraÈ™.</p>'; return; }
        let html=`<h2>Itinerariu pentru ${city}</h2>`;
        for(let i=1;i<=days;i++){
            const dayIndex=(i-1)%data[city].length;
            const dayActivities=data[city][dayIndex];
            html+=`<div class="day">
                <h3>Ziua ${i}</h3>
                <ul class="objectives">${dayActivities.map(a=>`<li><span class='time'>${a.time}</span> ${a.activity}</li>`).join('')}</ul>
            </div>`;
        }
        out.innerHTML=html;

        // animaÈ›ii fade + slide-up
        const daysEls = document.querySelectorAll('.day');
        daysEls.forEach((dayEl,index)=>{
            setTimeout(()=>{ dayEl.classList.add('show'); }, index*150);
            // click pe card pentru harta
            const dayIndex=(index)%data[city].length;
            dayEl.addEventListener('click',()=>{ showMap(data[city][dayIndex]); });
        });
    }catch(err){ console.error(err); out.innerHTML='<p>Eroare la Ã®ncÄƒrcarea datelor.</p>'; }
}

function showRecommendations(city, day) {
    const recOut = document.getElementById('recommendations');
    recOut.innerHTML = ""; // golim Ã®nainte de a afiÈ™a

    fetch('data.json')
        .then(response => {
            if (!response.ok) throw new Error('Nu s-a putut Ã®ncÄƒrca data.json');
            return response.json();
        })
        .then(data => {
            // presupunem structura: { "Paris": { "Ziua 1": ["rec1", "rec2"], ... }, "Roma": {...} }
            const recs = data[city]?.[day];
            if (!recs || recs.length == 0) {
                recOut.innerHTML = `<p>Nu existÄƒ recomandÄƒri pentru ${city} Ã®n ${day}</p>`;
                return;
            }
            recOut.innerHTML = `<h3>RecomandÄƒri pentru ${city}, ${day}</h3>
                                <ul>${recs.map(r => `<li>${r}</li>`).join('')}</ul>`;
        })
        .catch(error => {
            console.error(error);
            recOut.innerHTML = `<p>Eroare la Ã®ncÄƒrcarea recomandÄƒrilor.</p>`;
        });
}



function showMap(dayActivities){
    const mapDiv = document.getElementById('map');

    // distruge harta veche dacÄƒ existÄƒ
    if(map) {
        map.remove();
    }

    // alege prima locaÈ›ie ca centru
    const firstLat = dayActivities[0]?.lat || 48.8566;
    const firstLng = dayActivities[0]?.lng || 2.3522;

    map = L.map('map').setView([firstLat, firstLng], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // adaugÄƒ marker-ele
    dayActivities.forEach(act => {
        if(act.lat && act.lng){
            L.marker([act.lat, act.lng]).addTo(map).bindPopup(act.activity);
        }
    });
}

// ==== DARK MODE ====
function toggleTheme(){
    const cur=document.body.getAttribute("data-theme");
    document.body.setAttribute("data-theme", cur==='dark'?'light':'dark');
}

function initWorldMap() {
    const mapDiv = document.getElementById('map');

    if (map) {
        map.remove();
    }

    // Harta lumii
    map = L.map('map').setView([20, 0], 2); 

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);
}

// ==== FAQ ====
document.addEventListener('DOMContentLoaded',()=>{ document.querySelectorAll('.faq-question').forEach(btn=>{
    btn.addEventListener('click',()=>{ const ans=btn.nextElementSibling; ans.style.display=ans.style.display==='block'?'none':'block'; }); });
});
// ==== FAQ POPUP ====


document.getElementById('generateBtn')?.addEventListener('click', () => {
    const city = document.getElementById('citySelect').value;
    const day = document.getElementById('daySelect').value;

    if (!city || !day) {
        alert("SelecteazÄƒ oraÈ™ul È™i ziua!");
        return;
    }

    showRecommendations(city, day);
    showMap(city, day);
});

// Ã®ntrebÄƒrile se deschid/Ã®nchid
document.querySelectorAll('.faq-question').forEach(btn => {
    btn.addEventListener('click', () => {
        const answer = btn.nextElementSibling;
        answer.style.display = answer.style.display === 'block' ? 'none' : 'block';
    });
});

// HAMBURGER MENU (NOW HISTORY BUTTON)
const historyBtn = document.getElementById("historyBtn");
const rightMenu = document.getElementById("rightMenu");
const closeMenuBtn = document.getElementById("closeMenuBtn");

historyBtn.addEventListener("click", () => {
    const currentDisplay = rightMenu.style.display;
    rightMenu.style.display = currentDisplay === 'block' ? 'none' : 'block';
});

closeMenuBtn.addEventListener("click", () => {
    rightMenu.style.display = 'none';
});

function closeRightMenu() {
    rightMenu.style.display = 'none';
}

function saveCurrentTrip() {
    const city = document.getElementById("city").value;
    const days = document.getElementById("days").value;
    const list = document.getElementById("pastTripsList");
    
    const newTrip = document.createElement("li");
    newTrip.style.cssText = "padding:10px; background:#f0f0f0; margin-bottom:8px; border-radius:5px;";
    newTrip.innerHTML = `<strong>${city}</strong> - ${days} days<br><small>${new Date().toLocaleDateString()}</small>`;
    
    list.insertBefore(newTrip, list.firstChild);
    alert(`Trip to ${city} saved!`);
}

function addTodo() {
    const input = document.getElementById("todoInput");
    const task = input.value.trim();
    if (!task) return;
    
    const list = document.getElementById("toDoList");
    const newTodo = document.createElement("li");
    newTodo.style.cssText = "padding:8px; background:#fff3cd; margin-bottom:5px; border-radius:3px; border-left:3px solid #ffc107;";
    newTodo.innerHTML = `<input type="checkbox" onchange="this.parentElement.style.textDecoration=this.checked?'line-through':'none'"> ${task}`;
    
    list.appendChild(newTodo);
    input.value = "";
}

// Enter key for todo
document.addEventListener('DOMContentLoaded', () => {
    const todoInput = document.getElementById("todoInput");
    if (todoInput) {
        todoInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") addTodo();
        });
    }
});

// ==== INIT ====
window.onload=showApp;
</script>
</body>
</html>